<article class="post">
    <header class="post-header home">
        <div class="post-title">Category - <span id='category-name'></span></div>
    </header>

    <div class="post-content">
        {%- if site.posts.size > 0 -%}
        <ul class="post-list" id="post-list">
            {%- for post in site.posts -%}
            <li class="post-list-item post-category-{{post.categories}}" data-index="{{ forloop.index0 }}">
                {%- assign date_format = "%Y/%m/%d" -%}
                <span class="post-date">{{ post.date | date: date_format }}</span>
                <a class="post-link" href="{{ post.url | relative_url }}">
                    {{ post.title | escape }}
                </a>
                {%- if site.show_excerpts -%}{{ post.excerpt }}{%- endif -%}
            </li>
            {%- endfor -%}
        </ul>

        <!-- 페이지네이션 UI (숫자 버전 - 축약형, a 태그 사용) -->
        <nav class="pagination" id="pagination" style="display: none;" aria-label="Page navigation">
            <!-- 이전 버튼 -->
            <a href="#" class="pagination-btn pagination-prev disabled" id="prev-btn" aria-disabled="true" tabindex="-1">← 이전</a>

            <!-- 페이지 번호들 -->
            <div class="pagination-numbers" id="page-numbers"></div>

            <!-- 다음 버튼 -->
            <a href="#" class="pagination-btn pagination-next" id="next-btn">다음 →</a>
        </nav>

        {%- endif -%}
    </div>
</article>

<script src="/public/js/jquery-3.4.1.slim.min.js"></script>
<script>
    // 리스트 최대 개수 변경
    const postsPerPage = 20;
    let currentPage = 1;
    let filteredPosts = [];

    function updatePagination() {
        const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
        const $pagination = $('#pagination');
        const $prevBtn = $('#prev-btn');
        const $nextBtn = $('#next-btn');
        const $pageNumbers = $('#page-numbers');

        if (totalPages <= 1) {
            $pagination.hide();
            return;
        }
        $pagination.show();

        // 이전 버튼 disabled 설정 및 tabindex
        if (currentPage === 1) {
            $prevBtn.addClass('disabled').attr('aria-disabled', 'true').attr('tabindex', '-1').attr('href', '#');
        } else {
            $prevBtn.removeClass('disabled').attr('aria-disabled', 'false').removeAttr('tabindex');
            $prevBtn.attr('href', '#').off('click').on('click', (e) => {
                e.preventDefault();
                currentPage--;
                showCurrentPage();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        // 다음 버튼 disabled 설정 및 tabindex
        if (currentPage === totalPages) {
            $nextBtn.addClass('disabled').attr('aria-disabled', 'true').attr('tabindex', '-1').attr('href', '#');
        } else {
            $nextBtn.removeClass('disabled').attr('aria-disabled', 'false').removeAttr('tabindex');
            $nextBtn.attr('href', '#').off('click').on('click', (e) => {
                e.preventDefault();
                currentPage++;
                showCurrentPage();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        // 페이지 번호 생성 (축약형)
        $pageNumbers.empty();

        // 첫 페이지
        if (currentPage === 1) {
            $pageNumbers.append('<span class="pagination-number current">1</span>');
        } else {
            $pageNumbers.append('<a href="#" class="pagination-number" data-page="1">1</a>');
        }

        // ... (생략 표시) - 왼쪽
        if (currentPage > 3) {
            $pageNumbers.append('<span class="pagination-ellipsis">...</span>');
        }

        // 현재 페이지 주변 (현재-1, 현재, 현재+1)
        for (let i = 2; i < totalPages; i++) {
            const diff = Math.abs(i - currentPage);
            if (diff <= 1) {
                if (i === currentPage) {
                    $pageNumbers.append(`<span class="pagination-number current">${i}</span>`);
                } else {
                    $pageNumbers.append(`<a href="#" class="pagination-number" data-page="${i}">${i}</a>`);
                }
            }
        }

        // ... (생략 표시) - 오른쪽
        if (currentPage < totalPages - 2) {
            $pageNumbers.append('<span class="pagination-ellipsis">...</span>');
        }

        // 마지막 페이지
        if (totalPages > 1) {
            if (currentPage === totalPages) {
                $pageNumbers.append(`<span class="pagination-number current">${totalPages}</span>`);
            } else {
                $pageNumbers.append(`<a href="#" class="pagination-number" data-page="${totalPages}">${totalPages}</a>`);
            }
        }

        // 페이지 번호 클릭 이벤트
        $('.pagination-number').off('click').on('click', function(e) {
            e.preventDefault();
            const page = $(this).data('page');
            if (page) {
                currentPage = page;
                showCurrentPage();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
    }

    function showCurrentPage() {
        filteredPosts.forEach(post => $(post).hide());
        const start = (currentPage - 1) * postsPerPage;
        const end = start + postsPerPage;
        const postsToShow = filteredPosts.slice(start, end);
        postsToShow.forEach(post => $(post).show());
        updatePagination();
    }

    function filterAndPaginate() {
        currentPage = 1;
        if (window.location.hash) {
            let hash = window.location.hash.substring(1);
            $('#category-name').text(hash.charAt(0).toUpperCase() + hash.slice(1));

            filteredPosts = $('.post-list-item').filter(function() {
                return $(this).hasClass('post-category-' + hash);
            }).toArray();
            $('.post-list-item').hide();
        } else {
            $('#category-name').text('All');
            filteredPosts = $('.post-list-item').toArray();
        }
        showCurrentPage();
    }

    // 페이지 로드 및 해시 변경 이벤트
    $(document).ready(filterAndPaginate);
    $(window).on('hashchange', filterAndPaginate);
</script>
